import{r,a as z}from"./react-jhRHcHRD.js";import{R as B}from"./react-dom-TKT-5Ts1.js";import{m as Y,N as J,u as G,a as W,b as q,D as k,c as j,R as Q,d as X}from"./react-router-eY76U0wt.js";import{b as Z,d as $,E as ee,i as H,s as te}from"./@remix-run-SZecPcY6.js";/**
 * React Router DOM v6.21.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function T(){return T=Object.assign?Object.assign.bind():function(n){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o])}return n},T.apply(this,arguments)}function ye(n,t){return Z({basename:t==null?void 0:t.basename,future:T({},t==null?void 0:t.future,{v7_prependBasename:!0}),history:$({window:t==null?void 0:t.window}),hydrationData:(t==null?void 0:t.hydrationData)||ne(),routes:n,mapRouteProperties:Y,window:t==null?void 0:t.window}).initialize()}function ne(){var n;let t=(n=window)==null?void 0:n.__staticRouterHydrationData;return t&&t.errors&&(t=T({},t,{errors:re(t.errors)})),t}function re(n){if(!n)return null;let t=Object.entries(n),e={};for(let[o,i]of t)if(i&&i.__type==="RouteErrorResponse")e[o]=new ee(i.status,i.statusText,i.data,i.internal===!0);else if(i&&i.__type==="Error"){if(i.__subType){let u=window[i.__subType];if(typeof u=="function")try{let l=new u(i.message);l.stack="",e[o]=l}catch{}}if(e[o]==null){let u=new Error(i.message);u.stack="",e[o]=u}}else e[o]=i;return e}const ie=r.createContext({isTransitioning:!1}),oe=r.createContext(new Map),se="startTransition",D=z[se],ae="flushSync",N=B[ae];function le(n){D?D(n):n()}function R(n){N?N(n):n()}class ue{constructor(){this.status="pending",this.promise=new Promise((t,e)=>{this.resolve=o=>{this.status==="pending"&&(this.status="resolved",t(o))},this.reject=o=>{this.status==="pending"&&(this.status="rejected",e(o))}})}}function ge(n){let{fallbackElement:t,router:e,future:o}=n,[i,u]=r.useState(e.state),[l,c]=r.useState(),[v,m]=r.useState({isTransitioning:!1}),[s,S]=r.useState(),[f,y]=r.useState(),[g,I]=r.useState(),E=r.useRef(new Map),{v7_startTransition:O}=o||{},L=r.useCallback(a=>{O?le(a):a()},[O]),F=r.useCallback((a,h)=>{let{deletedFetchers:d,unstable_flushSync:U,unstable_viewTransitionOpts:w}=h;d.forEach(p=>E.current.delete(p)),a.fetchers.forEach((p,A)=>{p.data!==void 0&&E.current.set(A,p.data)});let M=e.window==null||typeof e.window.document.startViewTransition!="function";if(!w||M){U?R(()=>u(a)):L(()=>u(a));return}if(U){R(()=>{f&&(s&&s.resolve(),f.skipTransition()),m({isTransitioning:!0,flushSync:!0,currentLocation:w.currentLocation,nextLocation:w.nextLocation})});let p=e.window.document.startViewTransition(()=>{R(()=>u(a))});p.finished.finally(()=>{R(()=>{S(void 0),y(void 0),c(void 0),m({isTransitioning:!1})})}),R(()=>y(p));return}f?(s&&s.resolve(),f.skipTransition(),I({state:a,currentLocation:w.currentLocation,nextLocation:w.nextLocation})):(c(a),m({isTransitioning:!0,flushSync:!1,currentLocation:w.currentLocation,nextLocation:w.nextLocation}))},[e.window,f,s,E,L]);r.useLayoutEffect(()=>e.subscribe(F),[e,F]),r.useEffect(()=>{v.isTransitioning&&!v.flushSync&&S(new ue)},[v]),r.useEffect(()=>{if(s&&l&&e.window){let a=l,h=s.promise,d=e.window.document.startViewTransition(async()=>{L(()=>u(a)),await h});d.finished.finally(()=>{S(void 0),y(void 0),c(void 0),m({isTransitioning:!1})}),y(d)}},[L,l,s,e.window]),r.useEffect(()=>{s&&l&&i.location.key===l.location.key&&s.resolve()},[s,f,i.location,l]),r.useEffect(()=>{!v.isTransitioning&&g&&(c(g.state),m({isTransitioning:!0,flushSync:!1,currentLocation:g.currentLocation,nextLocation:g.nextLocation}),I(void 0))},[v.isTransitioning,g]),r.useEffect(()=>{},[]);let b=r.useMemo(()=>({createHref:e.createHref,encodeLocation:e.encodeLocation,go:a=>e.navigate(a),push:(a,h,d)=>e.navigate(a,{state:h,preventScrollReset:d==null?void 0:d.preventScrollReset}),replace:(a,h,d)=>e.navigate(a,{replace:!0,state:h,preventScrollReset:d==null?void 0:d.preventScrollReset})}),[e]),_=e.basename||"/",K=r.useMemo(()=>({router:e,navigator:b,static:!1,basename:_}),[e,b,_]);return r.createElement(r.Fragment,null,r.createElement(k.Provider,{value:K},r.createElement(j.Provider,{value:i},r.createElement(oe.Provider,{value:E.current},r.createElement(ie.Provider,{value:v},r.createElement(Q,{basename:_,location:i.location,navigationType:i.historyAction,navigator:b,future:{v7_relativeSplatPath:e.future.v7_relativeSplatPath}},i.initialized||e.future.v7_partialHydration?r.createElement(ce,{routes:e.routes,future:e.future,state:i}):t))))),null)}function ce(n){let{routes:t,future:e,state:o}=n;return X(t,void 0,o,e)}function Re(n){let{getKey:t,storageKey:e}=n;return ve({getKey:t,storageKey:e}),null}var C;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(C||(C={}));var P;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(P||(P={}));function fe(n){let t=r.useContext(k);return t||H(!1),t}function de(n){let t=r.useContext(j);return t||H(!1),t}const V="react-router-scroll-positions";let x={};function ve(n){let{getKey:t,storageKey:e}=n===void 0?{}:n,{router:o}=fe(C.UseScrollRestoration),{restoreScrollPosition:i,preventScrollReset:u}=de(P.UseScrollRestoration),{basename:l}=r.useContext(J),c=G(),v=W(),m=q();r.useEffect(()=>(window.history.scrollRestoration="manual",()=>{window.history.scrollRestoration="auto"}),[]),me(r.useCallback(()=>{if(m.state==="idle"){let s=(t?t(c,v):null)||c.key;x[s]=window.scrollY}try{sessionStorage.setItem(e||V,JSON.stringify(x))}catch{}window.history.scrollRestoration="auto"},[e,t,m.state,c,v])),typeof document<"u"&&(r.useLayoutEffect(()=>{try{let s=sessionStorage.getItem(e||V);s&&(x=JSON.parse(s))}catch{}},[e]),r.useLayoutEffect(()=>{let s=t&&l!=="/"?(f,y)=>t(T({},f,{pathname:te(f.pathname,l)||f.pathname}),y):t,S=o==null?void 0:o.enableScrollRestoration(x,()=>window.scrollY,s);return()=>S&&S()},[o,l,t]),r.useLayoutEffect(()=>{if(i!==!1){if(typeof i=="number"){window.scrollTo(0,i);return}if(c.hash){let s=document.getElementById(decodeURIComponent(c.hash.slice(1)));if(s){s.scrollIntoView();return}}u!==!0&&window.scrollTo(0,0)}},[c,i,u]))}function me(n,t){let{capture:e}=t||{};r.useEffect(()=>{let o=e!=null?{capture:e}:void 0;return window.addEventListener("pagehide",n,o),()=>{window.removeEventListener("pagehide",n,o)}},[n,e])}export{ge as R,Re as S,ye as c};
